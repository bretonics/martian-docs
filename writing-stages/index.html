<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>Writing Stages - Martian</title>
    <meta name="generator" content="Hugo 0.24.1" />

    
    <meta name="description" content="A material design theme for documentations.">
    
    <link rel="canonical" href="https://martian-lang.github.io/martian-docs/writing-stages/">
    
    <meta name="author" content="Digitalcraftsman">
    

    <meta property="og:url" content="https://martian-lang.github.io/martian-docs/writing-stages/">
    <meta property="og:title" content="Martian">
    <meta property="og:image" content="https://martian-lang.github.io/martian-docs/images/logo.png">
    <meta name="apple-mobile-web-app-title" content="Martian">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="https://martian-lang.github.io/martian-docs/images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="https://martian-lang.github.io/martian-docs/images/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('https://martian-lang.github.io/martian-docs/fonts/icon.eot');
        src: url('https://martian-lang.github.io/martian-docs/fonts/icon.eot')
               format('embedded-opentype'),
             url('https://martian-lang.github.io/martian-docs/fonts/icon.woff')
               format('woff'),
             url('https://martian-lang.github.io/martian-docs/fonts/icon.ttf')
               format('truetype'),
             url('https://martian-lang.github.io/martian-docs/fonts/icon.svg')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="https://martian-lang.github.io/martian-docs/stylesheets/application.css">
    <link rel="stylesheet" href="https://martian-lang.github.io/martian-docs/stylesheets/temporary.css">
    <link rel="stylesheet" href="https://martian-lang.github.io/martian-docs/stylesheets/palettes.css">
    <link rel="stylesheet" href="https://martian-lang.github.io/martian-docs/stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu&#43;Mono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <link rel="stylesheet" href="https://martian-lang.github.io/martian-docs/martian.css">
    
    <script src="https://martian-lang.github.io/martian-docs/javascripts/modernizr.js"></script>

    

  </head>
  <body class="palette-primary-red palette-accent-black">



	
	


<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        Martian
      </div>
    </div>

    

    
    <div class="button button-github" role="button" aria-label="GitHub">
      <a href="https://github.com/martian-lang" title="@martian-lang on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
    </div>
    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>

</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  

  <div class="scrollable">
    <div class="wrapper">
      
        
      

      <div class="toc">
        
        <ul>
          




<li>
  
    



<a  title="What is Martian?" href="https://martian-lang.github.io/martian-docs/">
	
	What is Martian?
</a>



  
</li>



<li>
  
    



<a  title="Getting Started" href="https://martian-lang.github.io/martian-docs/getting-started/">
	
	Getting Started
</a>



  
</li>



<li>
  
    



<a  title="Writing Pipelines" href="https://martian-lang.github.io/martian-docs/writing-pipelines/">
	
	Writing Pipelines
</a>



  
</li>



<li>
  
    



<a  title="Running Pipelines" href="https://martian-lang.github.io/martian-docs/running-pipelines/">
	
	Running Pipelines
</a>



  
</li>



<li>
  
    



<a  title="Inspecting Pipelines" href="https://martian-lang.github.io/martian-docs/inspecting-pipelines/">
	
	Inspecting Pipelines
</a>



  
</li>



<li>
  
    



<a class="current" title="Writing Stages" href="https://martian-lang.github.io/martian-docs/writing-stages/">
	
	Writing Stages
</a>


<ul id="scrollspy">
</ul>


  
</li>



<li>
  
    



<a  title="Advanced Features" href="https://martian-lang.github.io/martian-docs/advanced-features/">
	
	Advanced Features
</a>



  
</li>



<li>
  
    



<a  title="Language Details" href="https://martian-lang.github.io/martian-docs/language-details/">
	
	Language Details
</a>



  
</li>



<li>
  
    



<a  title="About" href="https://martian-lang.github.io/martian-docs/about/">
	
	About
</a>



  
</li>


        </ul>
        

        
        
        
        
        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>Writing Stages </h1>

			

<h2 id="overview">Overview</h2>

<p>Martian supports writing pipeline stages in virtually any language. The only requirement is that the language support JSON, which is nearly universal.</p>

<p>A Martian stage is an executable, either interpreted or compiled, that takes four command-line arguments as follows:</p>

<pre><code>$ stage_executable &lt;type&gt; &lt;metadata_path&gt; &lt;files_path&gt; &lt;journal_prefix&gt;
</code></pre>

<p>The <code>type</code> argument is one of <code>split</code>, <code>join</code>, or <code>main</code> (the main body of the stage). The stage executable should switch on that type and provide implementations for each.</p>

<h3 id="split-interface">Split Interface</h3>

<p>[ WIP ]</p>

<h3 id="join-interface">Join Interface</h3>

<p>[ WIP ]</p>

<h3 id="main-chunk-interface">Main/Chunk Interface</h3>

<p>[ WIP ]</p>

<p>More details in <a href="../advanced-features/#parallelization">Advanced Features: Parallelization</a>.</p>

<h2 id="martian-adapter">Martian Adapter</h2>

<p>Martian provides support for writing stages in the form of adapters, whose purpose is to provide to stages the following:</p>

<ul>
<li>A well-defined interface for stages to be invoked by <code>mrp</code></li>
<li>Input arguments from upstream stages to be passed into the stage</li>
<li>A well-defined method for returning output values to be passed to downstream stages</li>
<li>An API so the stage can provide logging, status updates, and error reporting to its parent <code>mrp</code></li>
</ul>

<p>The goal of Martian adapters is to minimize the amount of boilerplate code written for each stage implementation. Exactly how stage code is written and structured varies with the implementation language. Below are examples for some languages that currently have Martian adapters.</p>

<h2 id="martian-adapter-api">Martian Adapter API</h2>

<p>The Martian adapter provides a number of services to the stage code:</p>

<table>
<thead>
<tr>
<th>Method</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>martian.make_path(filename)</td>
<td></td>
</tr>

<tr>
<td>martian.get_martian_version</td>
<td></td>
</tr>

<tr>
<td>martian.get_pipelines_version</td>
<td></td>
</tr>

<tr>
<td>martian.update_progress(message)</td>
<td></td>
</tr>

<tr>
<td>martian.log_info(message)</td>
<td></td>
</tr>

<tr>
<td>martian.log_warn(message)</td>
<td></td>
</tr>

<tr>
<td>martian.log_time(message)</td>
<td></td>
</tr>

<tr>
<td>martian.log_json(label, obj)</td>
<td></td>
</tr>

<tr>
<td>martian.throw(message)</td>
<td></td>
</tr>

<tr>
<td>martian.exit(message)</td>
<td></td>
</tr>

<tr>
<td>martian.alarm(message)</td>
<td></td>
</tr>
</tbody>
</table>

<h2 id="interpreted-languages">Interpreted Languages</h2>

<h3 id="python">Python</h3>

<p>A Martian stage written in Python is simply a Python module. That is, a directory with an <code>__init__.py</code> containing the stage code. When writing a stage, you do not need to provide a <code>__main__</code> method as the Martian Python adapter provides an executable wrapper script that does an <code>import</code> of your Python module.</p>

<p>To satisfy the stage requirements, you must implement three functions <code>split</code>, <code>join</code>, and <code>main</code>, which will be called by the Martian Python adapter script.</p>

<p>The Python module should be located in its own directory somewhere under the <code>MROPATH</code>. The specific path is then specified in the MRO code to connect the MRO stage definition with the location of the Python implementation, e.g. <code>src py &quot;path/to/my/python_module&quot;</code>. Martian would then expect to be able to Python <code>import</code> that path as a module, and for it to implement <code>split</code>, <code>join</code> and <code>main</code> functions.</p>

<p>[ WIP ]</p>

<h2 id="compiled-languages">Compiled Languages</h2>

<p>Stage executables that are compiled must implement the command-line interface described above.</p>

<h3 id="rust">Rust</h3>

<h3 id="go">Go</h3>

<h2 id="shell-scripts">Shell Scripts</h2>

<p>Stage executables that are shell scripts must implement the command-line interface described above.</p>

<h2 id="writing-an-adapter">Writing an Adapter</h2>

<p>If you are interested in developing a new Martian language adapter or contributing to an existing one, you can find more details <a href="https://github.com/martian-lang/martian/tree/master/adapters">here</a>.</p>


			<aside class="copyright" role="note">
				
				
			</aside>

			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="https://martian-lang.github.io/martian-docs/inspecting-pipelines/" title="Inspecting Pipelines">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Inspecting Pipelines
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="https://martian-lang.github.io/martian-docs/advanced-features/" title="Advanced Features">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              Advanced Features
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = 'https:\/\/martian-lang.github.io\/martian-docs';
      var repo_id  = 'digitalcraftsman\/hugo-material-docs';
    
    </script>

    <script src="https://martian-lang.github.io/martian-docs/javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "#";
            headers[i].appendChild(a);
        }
      }
    </script>

    

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

